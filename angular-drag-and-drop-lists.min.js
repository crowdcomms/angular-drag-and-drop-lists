!function(e){var n="application/x-dnd",a="application/json",r="Text",t=["move","copy","link"];function d(e,n){return"all"==n?e:e.filter(function(e){return-1!=n.toLowerCase().indexOf(e)})}e.directive("dndDraggable",["$parse","$timeout",function(e,i){return function(l,f,c){f.attr("draggable","true"),c.dndDisableIf&&l.$watch(c.dndDisableIf,function(e){f.attr("draggable",!e)}),f.on("dragstart",function(s){if(s=s.originalEvent||s,"false"==f.attr("draggable"))return!0;o.isDragging=!0,o.itemType=c.dndType&&l.$eval(c.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=c.dndEffectAllowed||t[0],s.dataTransfer.effectAllowed=o.effectAllowed;var g=l.$eval(c.dndDraggable),u=n+(o.itemType?"-"+o.itemType:"");try{s.dataTransfer.setData(u,angular.toJson(g))}catch(e){var p=angular.toJson({item:g,type:o.itemType});try{s.dataTransfer.setData(a,p)}catch(e){var v=d(t,o.effectAllowed);s.dataTransfer.effectAllowed=v[0],s.dataTransfer.setData(r,p)}}if(f.addClass("dndDragging"),i(function(){f.addClass("dndDraggingSource")},0),s._dndHandle&&s.dataTransfer.setDragImage&&s.dataTransfer.setDragImage(f[0],0,0),e(c.dndDragstart)(l,{event:s}),c.dndCallback){var D=e(c.dndCallback);o.callback=function(e){return D(l,e||{})}}s.stopPropagation()}),f.on("dragend",function(n){n=n.originalEvent||n,l.$apply(function(){var a=o.dropEffect;e(c[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[a]])(l,{event:n}),e(c.dndDragend)(l,{event:n,dropEffect:a})}),o.isDragging=!1,o.callback=void 0,f.removeClass("dndDragging"),f.removeClass("dndDraggingSource"),n.stopPropagation(),i(function(){f.removeClass("dndDraggingSource")},0)}),f.on("click",function(n){c.dndSelected&&(n=n.originalEvent||n,l.$apply(function(){e(c.dndSelected)(l,{event:n})}),n.stopPropagation())}),f.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse",function(e){return function(i,l,f){var c=function(){var e;return angular.forEach(l.children(),function(n){var a=angular.element(n);a.hasClass("dndPlaceholder")&&(e=a)}),e||angular.element("<li class='dndPlaceholder'></li>")}();c.remove();var s=c[0],g=l[0],u={};function p(e){if(!e)return r;for(var t=0;t<e.length;t++)if(e[t]==r||e[t]==a||e[t].substr(0,n.length)==n)return e[t];return null}function v(e){return o.isDragging?o.itemType||void 0:e==r||e==a?null:e&&e.substr(n.length+1)||void 0}function D(e){return!u.disabled&&(!(!u.externalSources&&!o.isDragging)&&(!u.allowedTypes||null===e||e&&-1!=u.allowedTypes.indexOf(e)))}function y(e,n){var a=t;return n||(a=d(a,e.dataTransfer.effectAllowed)),o.isDragging&&(a=d(a,o.effectAllowed)),f.dndEffectAllowed&&(a=d(a,f.dndEffectAllowed)),a.length?e.ctrlKey&&-1!=a.indexOf("copy")?"copy":e.altKey&&-1!=a.indexOf("link")?"link":a[0]:"none"}function T(){return c.remove(),l.removeClass("dndDragover"),!0}function h(n,a,r,t,d,l){return e(n)(i,{callback:o.callback,dropEffect:r,event:a,external:!o.isDragging,index:void 0!==d?d:m(),item:l||void 0,type:t})}function m(){return Array.prototype.indexOf.call(g.children,s)}l.on("dragenter",function(e){e=e.originalEvent||e;var n=f.dndAllowedTypes&&i.$eval(f.dndAllowedTypes);u={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),disabled:f.dndDisableIf&&i.$eval(f.dndDisableIf),externalSources:f.dndExternalSources&&i.$eval(f.dndExternalSources),horizontal:f.dndHorizontalList&&i.$eval(f.dndHorizontalList)};var a=p(e.dataTransfer.types);if(!a||!D(v(a)))return!0;e.preventDefault()}),l.on("dragover",function(e){var n=p((e=e.originalEvent||e).dataTransfer.types),a=v(n);if(!n||!D(a))return!0;if(s.parentNode!=g&&l.append(c),e.target!=g){for(var t=e.target;t.parentNode!=g&&t.parentNode;)t=t.parentNode;if(t.parentNode==g&&t!=s){var d=t.getBoundingClientRect();if(u.horizontal)var o=e.clientX<d.left+d.width/2;else o=e.clientY<d.top+d.height/2;o?t.previousSibling!=s&&g.insertBefore(s,t):t.nextSibling!=s&&g.insertBefore(s,t.nextSibling)}}var i=n==r,m=y(e,i);return"none"==m?T():f.dndDragover&&!h(f.dndDragover,e,m,a)?T():(e.preventDefault(),i||(e.dataTransfer.dropEffect=m),l.addClass("dndDragover"),e.stopPropagation(),!1)}),l.on("drop",function(e){var n=p((e=e.originalEvent||e).dataTransfer.types),t=v(n);if(!n||!D(t))return!0;e.preventDefault();try{var d=JSON.parse(e.dataTransfer.getData(n))}catch(e){return T()}if((n==r||n==a)&&(t=d.type||void 0,d=d.item,!D(t)))return T();var l=n==r,c=y(e,l);if("none"==c)return T();var s=m();return f.dndDrop&&!(d=h(f.dndDrop,e,c,t,s,d))?T():(o.dropEffect=c,l||(e.dataTransfer.dropEffect=c),!0!==d&&i.$apply(function(){i.$eval(f.dndList).splice(s,0,d)}),h(f.dndInserted,e,c,t,s,d),T(),e.stopPropagation(),!1)}),l.on("dragleave",function(e){e=e.originalEvent||e;var n=document.elementFromPoint(e.clientX,e.clientY);g.contains(n)&&!e._dndPhShown?e._dndPhShown=!0:T()})}}]),e.directive("dndNodrag",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart",function(e){(e=e.originalEvent||e)._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){(e=e.originalEvent||e)._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart dragend",function(e){(e=e.originalEvent||e)._dndHandle=!0})}});var o={}}(angular.module("dndLists",[]));